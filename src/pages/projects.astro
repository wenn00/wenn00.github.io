---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProjectCard from '../components/ProjectCard.astro';

const allProjects = [
  {
    title: '個人作品集網站',
    description: '使用 Astro + TailwindCSS 建立的個人網站，支援中英雙語切換。',
    tags: ['Astro', 'TailwindCSS', 'TypeScript'],
    github: 'https://github.com/wenn00/wenn00.github.io',
    demo: 'https://wenn00.github.io',
    image: '/images/projects/portfolio.svg',
    isPrivate: false,
  },
  {
    title: '自動駕駛小車',
    description: '基於 F1tenth 平台的自動駕駛專案，實作了路徑規劃與避障演算法。',
    tags: ['Python', 'ROS2', 'C++'],
    image: '/images/projects/f1tenth.svg',
    isPrivate: true,
  },
  {
    title: '手勢辨識系統',
    description: '使用 MediaPipe 進行即時手勢辨識，可控制簡報翻頁。',
    tags: ['Python', 'MediaPipe', 'OpenCV'],
    github: 'https://github.com/wenn00/hand_detect',
    image: '/images/projects/hand-detect.svg',
    isPrivate: false,
  },
  {
    title: 'AI 聊天機器人',
    description: '串接 LLM API 的聊天機器人，支援多輪對話與上下文記憶。',
    tags: ['Python', 'FastAPI', 'React'],
    github: 'https://github.com/wenn00/AIChatPractice',
    image: '/images/projects/ai-chat.svg',
    isPrivate: false,
  },
  {
    title: '舞蹈教學平台',
    description: '使用姿態估計技術的互動式舞蹈教學應用。',
    tags: ['Python', 'MediaPipe', 'Web'],
    image: '/images/projects/dance.svg',
    isPrivate: false,
  },
];
---

<BaseLayout title="專案 - Wenn">
  <section class="py-16">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h1 class="text-3xl font-bold text-heading mb-3" data-i18n="projects.title">所有專案</h1>
        <p class="text-body" data-i18n="projects.subtitle">我在課堂與個人時間完成的各種專案</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-grid">
        {allProjects.map(project => (
          <ProjectCard
            title={project.title}
            description={project.description}
            tags={project.tags}
            image={project.image}
            github={project.github}
            demo={project.demo}
            isPrivate={project.isPrivate}
          />
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  import { getLang } from '../i18n/utils';
  import zh from '../i18n/zh.json';
  import en from '../i18n/en.json';

  const translations: Record<string, Record<string, unknown>> = { zh, en };

  function getNestedValue(obj: unknown, path: string): string | undefined {
    const keys = path.split('.');
    let value: unknown = obj;
    for (const k of keys) {
      if (value && typeof value === 'object') {
        value = (value as Record<string, unknown>)[k];
      } else {
        return undefined;
      }
    }
    return typeof value === 'string' ? value : undefined;
  }

  const lang = getLang();
  const dict = translations[lang] ?? translations['zh'];

  // Update i18n text
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (key) {
      const text = getNestedValue(dict, key);
      if (text) el.textContent = text;
    }
  });

  // Update project cards from translations
  if (lang === 'en') {
    const projectList = (en as Record<string, unknown>).project_list as Array<Record<string, string>>;
    const cards = document.querySelectorAll('#projects-grid > div');
    cards.forEach((card, i) => {
      if (projectList[i]) {
        const titleEl = card.querySelector('h3');
        const descEl = card.querySelector('p.text-sm.text-body');
        if (titleEl) titleEl.textContent = projectList[i].title;
        if (descEl) descEl.textContent = projectList[i].description;
      }
    });
  }
</script>
